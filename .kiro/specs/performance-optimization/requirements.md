# Requirements Document

## Introduction

現在のリアルタイムOCRアプリケーションは、物体検知とOCR実行中に1FPS未満のパフォーマンスしか出ていません。Macbook Pro M3 Proという高性能な環境で動作しているため、ハードウェアの問題ではなく、実装アルゴリズムや処理フローに改善の余地があると考えられます。本要件では、実用的な5FPS以上を達成するためのパフォーマンス改善を目指します。

## Requirements

### Requirement 1: パフォーマンスボトルネックの特定

**User Story:** 開発者として、現在のアプリケーションのパフォーマンスボトルネックを特定したい。そうすることで、効果的な改善策を立案できる。

#### Acceptance Criteria

1. WHEN アプリケーションの各処理ステップ（ウィンドウキャプチャ、物体検出、OCR処理、描画）の実行時間を計測する THEN システムは各ステップの平均実行時間とボトルネックを特定できる SHALL
2. WHEN 処理フローを分析する THEN システムは同期処理と非同期処理の機会を識別できる SHALL
3. WHEN メモリ使用量とCPU/GPU使用率を監視する THEN システムはリソース使用の非効率性を特定できる SHALL

### Requirement 2: フレーム処理の最適化

**User Story:** ユーザーとして、リアルタイムでスムーズな画面表示を体験したい。そうすることで、実用的にアプリケーションを使用できる。

#### Acceptance Criteria

1. WHEN フレームキャプチャが実行される THEN システムは不要なフレームをスキップして処理負荷を軽減する SHALL
2. WHEN 物体検出が実行される THEN システムは検出結果をキャッシュして重複処理を避ける SHALL
3. WHEN 画面描画が実行される THEN システムは処理中のフレームと表示フレームを分離して、表示が処理をブロックしない SHALL

### Requirement 3: 並列処理の導入

**User Story:** 開発者として、複数のコアを活用した並列処理を実装したい。そうすることで、M3 Proの性能を最大限に引き出せる。

#### Acceptance Criteria

1. WHEN フレームキャプチャと物体検出が実行される THEN システムは別々のスレッドで並列実行する SHALL
2. WHEN 複数の検出領域に対してOCR処理が実行される THEN システムは並列にOCR処理を実行する SHALL
3. WHEN スレッド間でデータを共有する THEN システムはスレッドセーフなキューを使用してデータ競合を防ぐ SHALL

### Requirement 4: OCR処理の最適化

**User Story:** ユーザーとして、OCR処理が高速に実行されることを期待する。そうすることで、リアルタイム性が向上する。

#### Acceptance Criteria

1. WHEN 同じ領域が連続して検出される THEN システムはOCR結果をキャッシュして再処理を避ける SHALL
2. WHEN OCR処理が実行される THEN システムは画像の前処理を最小限に抑えて処理時間を短縮する SHALL
3. WHEN 複数の検出領域がある THEN システムは優先度（画面上部から順）に基づいて処理する SHALL

### Requirement 5: パフォーマンス計測とモニタリング

**User Story:** 開発者として、リアルタイムでパフォーマンスメトリクスを確認したい。そうすることで、改善効果を検証できる。

#### Acceptance Criteria

1. WHEN アプリケーションが実行される THEN システムは現在のFPSをリアルタイムで表示する SHALL
2. WHEN 各処理ステップが完了する THEN システムは処理時間をログに記録する SHALL
3. WHEN パフォーマンスが目標（5FPS）を下回る THEN システムは警告を表示する SHALL

### Requirement 6: 設定可能なパフォーマンスモード

**User Story:** ユーザーとして、精度とパフォーマンスのバランスを調整したい。そうすることで、用途に応じた最適な設定を選択できる。

#### Acceptance Criteria

1. WHEN ユーザーがパフォーマンスモードを選択する THEN システムは処理頻度と精度のバランスを調整する SHALL
2. WHEN 高速モードが選択される THEN システムはフレームスキップとキャッシュを積極的に使用する SHALL
3. WHEN 高精度モードが選択される THEN システムは全フレームを処理してOCRキャッシュを無効化する SHALL
